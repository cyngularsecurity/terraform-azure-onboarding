# Variables
TERRAFORM_VERSION = 1.4.6
AZ_CLI_VERSION = 2.31.0
PROJECT_DIR = $(shell pwd)
TF_STATE_BUCKET = your-terraform-state-bucket
TF_STATE_KEY = your-terraform-state-key

# Azure CLI Install/Update Commands
install-az-cli:
	@echo "Installing Azure CLI..."
	curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

update-az-cli:
	@echo "Updating Azure CLI..."
	sudo apt-get update && sudo apt-get install --only-upgrade -y azure-cli

# Terraform Install/Update Commands
install-terraform:
	@echo "Installing Terraform..."
	curl -LO https://releases.hashicorp.com/terraform/$(TERRAFORM_VERSION)/terraform_$(TERRAFORM_VERSION)_linux_amd64.zip
	unzip terraform_$(TERRAFORM_VERSION)_linux_amd64.zip
	sudo mv terraform /usr/local/bin/
	rm terraform_$(TERRAFORM_VERSION)_linux_amd64.zip

update-terraform:
	@echo "Updating Terraform..."
	curl -LO https://releases.hashicorp.com/terraform/$(TERRAFORM_VERSION)/terraform_$(TERRAFORM_VERSION)_linux_amd64.zip
	unzip terraform_$(TERRAFORM_VERSION)_linux_amd64.zip
	sudo mv terraform /usr/local/bin/
	rm terraform_$(TERRAFORM_VERSION)_linux_amd64.zip

# Terraform Commands
init:
	@echo "Initializing Terraform..."
	terraform init -backend-config="bucket=$(TF_STATE_BUCKET)" -backend-config="key=$(TF_STATE_KEY)" -backend-config="region=your-region"

plan:
	@echo "Planning Terraform changes..."
	terraform plan

apply:
	@echo "Applying Terraform changes..."
	terraform apply -auto-approve

destroy:
	@echo "Destroying Terraform-managed infrastructure..."
	terraform destroy -auto-approve

fmt:
	@echo "Formatting Terraform files..."
	terraform fmt -recursive

validate:
	@echo "Validating Terraform configuration..."
	terraform validate

# Clean-up
clean:
	@echo "Cleaning up Terraform files..."
	rm -rf .terraform
	rm -f .terraform.lock.hcl

# Full Setup (Install/Update Tools, Init, Plan, Apply)
setup:
	@make install-az-cli
	@make update-az-cli
	@make install-terraform
	@make update-terraform
	@make init
	@make plan

.PHONY: install-az-cli update-az-cli install-terraform update-terraform init plan apply destroy fmt validate clean setup