2023-10-17 23:32:21,317 - INFO - Adding extension named account
2023-10-17 23:32:28,151 - INFO - Collecting client subscriptions id
2023-10-17 23:32:30,118 - INFO - Creating cyngular service principal
2023-10-17 23:32:41,936 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: Resource 'afc781b9-5e87-4022-a1e6-f9dc743905c8' does not exist or one of its queried reference-property objects are not present.\n"  "az ad sp show --id afc781b9-5e87-4022-a1e6-f9dc743905c8 --query id in => get_principal_object_id"

2023-10-17 23:32:41,936 - INFO - Creating CyngularRG resource group
2023-10-17 23:32:44,434 - INFO - Creating audit storage account
2023-10-17 23:33:09,934 - INFO - Creating nsg storage account
2023-10-17 23:33:37,048 - INFO - Getting the storage accounts connection strings
2023-10-17 23:33:41,497 - INFO - The current subscription is: b682a811-395f-4eae-828b-b099faf3fe44
2023-10-17 23:33:41,497 - INFO - The current subscription is: a40cfbac-9172-4609-841e-76f520567845
2023-10-17 23:33:41,498 - INFO - The current subscription is: 373cb248-9e3b-4f65-8174-c72d253103ea
2023-10-17 23:33:42,552 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Reader --scope /subscriptions/a40cfbac-9172-4609-841e-76f520567845 in => assign_subscription_role"

2023-10-17 23:33:43,045 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Reader --scope /subscriptions/b682a811-395f-4eae-828b-b099faf3fe44 in => assign_subscription_role"

2023-10-17 23:33:43,083 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Reader --scope /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea in => assign_subscription_role"

2023-10-17 23:33:43,494 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Disk Pool Operator --scope /subscriptions/a40cfbac-9172-4609-841e-76f520567845 in => assign_subscription_role"

2023-10-17 23:33:44,467 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Data Operator for Managed Disks --scope /subscriptions/a40cfbac-9172-4609-841e-76f520567845 in => assign_subscription_role"

2023-10-17 23:33:44,486 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Disk Pool Operator --scope /subscriptions/b682a811-395f-4eae-828b-b099faf3fe44 in => assign_subscription_role"

2023-10-17 23:33:44,574 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Disk Pool Operator --scope /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea in => assign_subscription_role"

2023-10-17 23:33:45,581 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Data Operator for Managed Disks --scope /subscriptions/b682a811-395f-4eae-828b-b099faf3fe44 in => assign_subscription_role"

2023-10-17 23:33:45,582 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Disk Snapshot Contributor --scope /subscriptions/a40cfbac-9172-4609-841e-76f520567845 in => assign_subscription_role"

2023-10-17 23:33:46,062 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Data Operator for Managed Disks --scope /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea in => assign_subscription_role"

2023-10-17 23:33:46,530 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Authorization/roleDefinitions/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Microsoft Sentinel Reader --scope /subscriptions/a40cfbac-9172-4609-841e-76f520567845 in => assign_subscription_role"

2023-10-17 23:33:46,530 - INFO - Exporting activity logs from subscription: a40cfbac-9172-4609-841e-76f520567845
2023-10-17 23:33:46,927 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Disk Snapshot Contributor --scope /subscriptions/b682a811-395f-4eae-828b-b099faf3fe44 in => assign_subscription_role"

2023-10-17 23:33:47,179 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Disk Snapshot Contributor --scope /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea in => assign_subscription_role"

2023-10-17 23:33:47,829 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Microsoft Sentinel Reader --scope /subscriptions/b682a811-395f-4eae-828b-b099faf3fe44 in => assign_subscription_role"

2023-10-17 23:33:47,830 - INFO - Exporting activity logs from subscription: b682a811-395f-4eae-828b-b099faf3fe44
2023-10-17 23:33:48,665 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (InvalidPrincipalId) The Principal ID 'None' is not valid. Principal ID must be a GUID.\nCode: InvalidPrincipalId\nMessage: The Principal ID 'None' is not valid. Principal ID must be a GUID.\n"  "az role assignment create --assignee-object-id None --assignee-principal-type ServicePrincipal --role Microsoft Sentinel Reader --scope /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea in => assign_subscription_role"

2023-10-17 23:33:48,666 - INFO - Exporting activity logs from subscription: 373cb248-9e3b-4f65-8174-c72d253103ea
2023-10-17 23:33:51,932 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b'ERROR: The target scope "resourceGroup" does not match the deployment scope "subscription".\n'  "az deployment sub create --location eastus2 --template-file ActivityLog.bicep --parameters settingName=cyngularDiagnostic storageAccountId=/subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea/resourceGroups/CyngularRG/providers/Microsoft.Storage/storageAccounts/cyngularauditjokers --subscription a40cfbac-9172-4609-841e-76f520567845 in => export_activity_logs"

2023-10-17 23:33:51,932 - INFO - Creating NetworkWatcherRG resource group using subscription
2023-10-17 23:33:51,989 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b'ERROR: The target scope "resourceGroup" does not match the deployment scope "subscription".\n'  "az deployment sub create --location eastus2 --template-file ActivityLog.bicep --parameters settingName=cyngularDiagnostic storageAccountId=/subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea/resourceGroups/CyngularRG/providers/Microsoft.Storage/storageAccounts/cyngularauditjokers --subscription b682a811-395f-4eae-828b-b099faf3fe44 in => export_activity_logs"

2023-10-17 23:33:51,990 - INFO - Creating NetworkWatcherRG resource group using subscription
2023-10-17 23:33:52,738 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b'ERROR: The target scope "resourceGroup" does not match the deployment scope "subscription".\n'  "az deployment sub create --location eastus2 --template-file ActivityLog.bicep --parameters settingName=cyngularDiagnostic storageAccountId=/subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea/resourceGroups/CyngularRG/providers/Microsoft.Storage/storageAccounts/cyngularauditjokers --subscription 373cb248-9e3b-4f65-8174-c72d253103ea in => export_activity_logs"

2023-10-17 23:33:52,738 - INFO - Creating NetworkWatcherRG resource group using subscription
2023-10-17 23:33:52,858 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Resources/subscriptions/resourcegroups/write' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845/resourcegroups/NetworkWatcherRG' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Resources/subscriptions/resourcegroups/write' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845/resourcegroups/NetworkWatcherRG' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az group create -l eastus2 -n NetworkWatcherRG --subscription a40cfbac-9172-4609-841e-76f520567845 in => create_resource_group_with_subscription"

2023-10-17 23:33:53,935 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (AuthorizationFailed) The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Resources/subscriptions/resourcegroups/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\nCode: AuthorizationFailed\nMessage: The client 'dvirg@azuresandboxcyngularsecurit.onmicrosoft.com' with object id 'ea69e391-c73e-4119-9281-7168117a2758' does not have authorization to perform action 'Microsoft.Resources/subscriptions/resourcegroups/read' over scope '/subscriptions/a40cfbac-9172-4609-841e-76f520567845' or the scope is invalid. If access was recently granted, please refresh your credentials.\n"  "az group list --subscription a40cfbac-9172-4609-841e-76f520567845 in => get_resource_groups"

2023-10-17 23:33:53,935 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 259, in get_resource_groups
    for group in res:
TypeError: 'NoneType' object is not iterable

2023-10-17 23:33:53,935 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 375, in subscription_manager
    for subscription_resource_group in resource_groups:
TypeError: 'NoneType' object is not iterable

2023-10-17 23:33:55,570 - INFO - Collecting nsg flow logs from resource group: testResourceGroup
2023-10-17 23:33:55,570 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-EUS
2023-10-17 23:33:55,573 - INFO - Collecting nsg flow logs from resource group: cloud-shell-storage-westeurope
2023-10-17 23:33:55,573 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-EUS2
2023-10-17 23:33:55,573 - INFO - Collecting nsg flow logs from resource group: NetworkWatcherRG
2023-10-17 23:33:56,428 - INFO - Collecting nsg flow logs from resource group: cloud-shell-storage-westeurope
2023-10-17 23:33:56,428 - INFO - Collecting nsg flow logs from resource group: cyngular-northcentralus
2023-10-17 23:33:56,429 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-NCUS
2023-10-17 23:33:56,430 - INFO - Collecting nsg flow logs from resource group: DeleteToday
2023-10-17 23:33:56,430 - INFO - Collecting nsg flow logs from resource group: synapseworkspace-managedrg-c0bb1550-291e-4685-897e-21d562aa8247
2023-10-17 23:33:56,431 - INFO - Collecting nsg flow logs from resource group: sandbox
2023-10-17 23:33:56,432 - INFO - Collecting nsg flow logs from resource group: CyngularRG
2023-10-17 23:33:56,433 - INFO - Collecting nsg flow logs from resource group: NetworkWatcherRG
2023-10-17 23:33:56,438 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-CUS
2023-10-17 23:33:56,441 - INFO - Collecting nsg flow logs from resource group: eastus_cyngular_prod
2023-10-17 23:34:05,585 - INFO - Collecting nsg flow logs from resource group: cloud-shell-storage-eastus
2023-10-17 23:34:05,939 - INFO - Collecting nsg flow logs from resource group: arad_eden_staging_resource_group
2023-10-17 23:34:06,373 - INFO - Collecting nsg flow logs from resource group: VM-clientx-splunk-service_group
2023-10-17 23:34:06,514 - INFO - Collecting nsg flow logs from resource group: cyngularGroup
2023-10-17 23:34:06,553 - INFO - Collecting nsg flow logs from resource group: cyngularGroupTest
2023-10-17 23:34:07,153 - INFO - Collecting nsg flow logs from resource group: examplefunctionapp
2023-10-17 23:34:07,155 - INFO - Collecting nsg flow logs from resource group: cloud-shell-storage-northeurope
2023-10-17 23:34:07,170 - INFO - Collecting nsg flow logs from resource group: leshem-test
2023-10-17 23:34:12,074 - INFO - Importing diagnostic settings
2023-10-17 23:34:13,628 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-WUS
2023-10-17 23:34:13,762 - INFO - Collecting nsg flow logs from resource group: check6
2023-10-17 23:34:14,151 - INFO - Collecting nsg flow logs from resource group: api_group
2023-10-17 23:34:14,169 - INFO - Collecting nsg flow logs from resource group: vns3-peoplevpn_group
2023-10-17 23:34:17,250 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (ResourceTypeNotSupported) The resource type 'microsoft.network/networkwatchers' does not support diagnostic settings.\nCode: ResourceTypeNotSupported\nMessage: The resource type 'microsoft.network/networkwatchers' does not support diagnostic settings.\n"  "az monitor diagnostic-settings create --name cyngularDiagnostic --resource /subscriptions/b682a811-395f-4eae-828b-b099faf3fe44/resourceGroups/NetworkWatcherRG/providers/Microsoft.Network/networkWatchers/eastus2-watcher --storage-account /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea/resourceGroups/CyngularRG/providers/Microsoft.Storage/storageAccounts/cyngularauditjokers --logs [{category:AuditEvent,enabled:true,retention-policy:{enabled:false,days:30}}] in => import_diagnostic_settings"

2023-10-17 23:34:17,308 - INFO - Collecting nsg flow logs from resource group: peoplevpn_group
2023-10-17 23:34:18,526 - INFO - Collecting nsg flow logs from resource group: vpnserver_group
2023-10-17 23:34:21,548 - INFO - Collecting nsg flow logs from resource group: opnsense_group
2023-10-17 23:34:24,232 - INFO - Collecting nsg flow logs from resource group: SoftEther_group
2023-10-17 23:34:25,307 - INFO - Collecting nsg flow logs from resource group: proxy-server_group
2023-10-17 23:34:26,411 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-EUS
2023-10-17 23:34:29,283 - INFO - Collecting nsg flow logs from resource group: tal-functionapp_group
2023-10-17 23:34:29,926 - INFO - Collecting nsg flow logs from resource group: raphi-rg
2023-10-17 23:34:30,304 - INFO - Collecting nsg flow logs from resource group: MC_tal-functionapp_group_tal-test_eastus
2023-10-17 23:34:30,565 - INFO - Collecting nsg flow logs from resource group: yogev_rg
2023-10-17 23:34:31,704 - INFO - Collecting nsg flow logs from resource group: Workspace-rg
2023-10-17 23:34:33,804 - INFO - Collecting nsg flow logs from resource group: DefaultResourceGroup-WEU
2023-10-17 23:34:51,769 - INFO - Importing diagnostic settings
2023-10-17 23:34:54,226 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"ERROR: (ResourceTypeNotSupported) The resource type 'microsoft.network/networkwatchers' does not support diagnostic settings.\nCode: ResourceTypeNotSupported\nMessage: The resource type 'microsoft.network/networkwatchers' does not support diagnostic settings.\n"  "az monitor diagnostic-settings create --name cyngularDiagnostic --resource /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea/resourceGroups/NetworkWatcherRG/providers/Microsoft.Network/networkWatchers/eastus2-watcher --storage-account /subscriptions/373cb248-9e3b-4f65-8174-c72d253103ea/resourceGroups/CyngularRG/providers/Microsoft.Storage/storageAccounts/cyngularauditjokers --logs [{category:AuditEvent,enabled:true,retention-policy:{enabled:false,days:30}}] in => import_diagnostic_settings"

2023-10-17 23:34:54,226 - INFO - FINISHED ONBOARDING
2023-10-17 23:34:54,227 - INFO - Importing public key
2023-10-17 23:34:54,267 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"gpg: WARNING: unsafe ownership on homedir '/Users/dvirgross/.gnupg'\ngpg: failed to create temporary file '/Users/dvirgross/.gnupg/.#lk0x0000600001738750.Dvirs-MacBook-Air.local.20457': Permission denied\ngpg: keyblock resource '/Users/dvirgross/.gnupg/pubring.kbx': Permission denied\ngpg: no writable keyring found: Not found\ngpg: error reading 'CyngularPublic.key': General error\ngpg: import from 'CyngularPublic.key' failed: General error\ngpg: Total number processed: 0\n"  "gpg --import CyngularPublic.key in => import_public_key"

2023-10-17 23:34:54,267 - INFO - Encrypting jokers_data.txt file with public key
2023-10-17 23:34:54,275 - CRITICAL - Traceback (most recent call last):
  File "/Users/dvirgross/projects/Infra/Azure/azure-client-onboarding/CyngularOnboardingV3.py", line 44, in azcli
    raise ValueError(str(err) + '  "' + " ".join(cli_args) + ' in => ' + sys._getframe(1).f_code.co_name + '"')
ValueError: b"gpg: WARNING: unsafe ownership on homedir '/Users/dvirgross/.gnupg'\ngpg: failed to create temporary file '/Users/dvirgross/.gnupg/.#lk0x0000600001b142d0.Dvirs-MacBook-Air.local.20458': Permission denied\ngpg: keyblock resource '/Users/dvirgross/.gnupg/pubring.kbx': Permission denied\ngpg: failed to create temporary file '/Users/dvirgross/.gnupg/.#lk0x0000600001b14210.Dvirs-MacBook-Air.local.20458': Permission denied\ngpg: can't connect to the dirmngr: Permission denied\ngpg: error retrieving 'cyngularsecurity@gmail.com' via WKD: No dirmngr\ngpg: cyngularsecurity@gmail.com: skipped: No dirmngr\ngpg: jokers_data.txt: encryption failed: No dirmngr\n"  "gpg --encrypt --armor -r cyngularsecurity@gmail.com jokers_data.txt in => encrypt_data"

